---
title: 07-常见场景问题
description: 07-常见场景问题
published: true
date: 2023-09-22T09:46:05.755Z
tags: 咕泡, 面试, 场景
editor: markdown
dateCreated: 2023-09-22T09:46:05.755Z
---

# 07-常见场景问题

## 1. 订单超时自动取消功能如何设计
> 利用主流 MQ 中的延迟消息功能，消息发送到 Broker 上以后并不会立刻投递，而是根据消息中设置的延迟时间去投递。我们只需要把新的订单并计算这个订单的超时时间发送到 MQ 中即可。MQ 这种实现方式在性能、可扩展性、稳定性上都比较好，是一个不错的选择。
1. 定时轮询, 有延迟，数据库压力大
2. 惰性取消，查询时取消，影响查询效率
3. JDK延迟队列DelayQueue，
4. 时间轮：Netty的HashedWheelTimer；异常恢复困难，集群扩展麻烦，内存占用。
5. Redis过期回调：需要额外维护redis。
6. Redis有序集合：可能重复消费同一key。
7. 任务调度：使用任务调度中间件xxl-job、ScheduleX、Elastic-Job等来实现，设置一个调度时间cron，到达订单过期的调度时间时，触发任务执行取消订单业务逻辑。实现复杂，维护成本高。
8. 消息队列：使用RocketMQ、RabbitMQ、Kafka的延时消息，消息在发送到消息队列服务端后并不会立马投递，而是根据消息中的属性延迟固定时间后才投递给消费者。