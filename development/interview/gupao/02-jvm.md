---
title: 02-JVM常见问题
description: JVM相关的一些问题
published: true
date: 2023-08-17T07:38:39.646Z
tags: jvm, 咕泡, 面试
editor: markdown
dateCreated: 2023-08-17T07:22:28.250Z
---

# 02-JVM相关问题

## 01 CPU 飙高系统反应慢怎么排查
1. CPU最小执行单元是线程。
2. 导致 CPU 飙高的原因有几个方面：
 - 2.1 上下文切换过多  (文件 IO、网络 IO、锁等待、线程阻塞等操作)
 - 2.2 CPU 资源过度消耗:创建了大量的线程，或线程一直占用CPU 资源无法被释放，比如死循环！
3. 解决方案：通过 `top` 命令，找到 CPU 利用率较高的进程，在通过 `Shift+H` 找到进程中 CPU 消耗过高的线程
  - 如过是同一个线程，说明程序中存在线程长期占用 CPU 没有释放的情况，这种情况直接通过 jstack 获得线程的 Dump 日志，定位到线程日志后就可以找到问题的代码。
 - 如果线程 id 不断变化，说明线程创建过多，需要挑选几个线程id，通过 jstack 去线程 dump 日志中排查。
5. 有可能定位的结果是程序正常，只是在 CPU 飙高的那一刻，用户访问量较大，导致系统资源不够。 

## 02 线上OOM问题排查
1. 内存泄漏或内存溢出
2. 设置JVM参数，增大内存
3. OOM时候先获取dump文件(`-XX: +HeapDumpOnOutOfMemoryError` 或 `jmap -dump:[live],format=b,file=<file-path> <pid> `).然后使用 MAT 工具来分析 Dump 文件.
  - 3.1 内存泄漏，可进一步通过工具查看泄漏对象到 GC Roots 的引用链。掌握了泄漏对象的类信息和 GC Roots 引用链的信息，就可以比较准确地定位泄漏代码的位置。
  - 3.2 如果是普通的内存溢出，确实有很多占用内存的对象，那就只需要提升堆内存空间即可。
