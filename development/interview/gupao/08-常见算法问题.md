---
title: 08-常见算法问题
description: 常见算法问题
published: true
date: 2023-09-27T09:41:56.368Z
tags: 咕泡, 面试, 算法
editor: markdown
dateCreated: 2023-09-27T09:32:45.982Z
---

# 08-常见算法问题
 
 ## 01 什么是时间轮算法
 1. 间轮，简单理解就是一种用来**存储一系列定时任务的环状数组**，它的整个工作原理和我们的钟表的表盘类似
 2. 由两个部分组成， 一个是环状数组，另一个是遍历环状数组的指针。
   - 2.1 首先，定义一个固定长度的环状数组，然后数组的每一个元素代表一个时间刻度，假设是 1s，那么如果是长度为 8 的数组，就代表 8 秒钟。
   - 2.2 然后，有一个指针，这个指针按照顺时针无线循环这个数组，每隔最小时间单位前进一个数组索引。
   - 2.3 这个指针转一圈代表 8 秒钟，转两圈表示 16 秒，假设从 0 点 0 分 0 秒开始，转一圈以后就到了 0 点 0 分 9 秒钟
   - 2.4 环状数组里面的每个元素都是用来存储定时任务的容器，当我们向时间轮里面添加一个定时任务的时候，我们会根据定时任务的执行时间计算它所存储的数组下标。
   - 2.5 当指针指向某个数组的时候，就会把这个数组中存储的任务取出来，然后遍历这个链表逐个运行里面的任务。
   - 2.6 如果某个定时任务的执行时间大于环形数组所表示的长度，一般可以使用一个圈数来表示该任务的延迟执行时间。
   - 2.7 也就是说，如果是第 16 秒要执行的任务，那意味着这个任务应该是在第二圈的数组下标 0 位置执行
3. 使用时间轮的方式来管理多个定时任务的好处有很多，我认为有两个核心原因：
  - 3.1 减少定时任务添加和删除的时间复杂度，提升性能。
  - 3.2 可保证每次执行定时器任务都是 O（1）复杂度，在定时器任务密集的情况下，性能优势非常明显。
4. 缺点：对于执行时间非常严格的任务，时间轮不是很适合，因为时间轮算法的精度取决于最小时间单元的粒度。假设以 1s 为一个时间刻度，那小于 1s 的任务就无法被时间轮调度。
5. 时间轮算法在很多地方都有用到，比如 Dubbo、Netty、Kafka 等。

## 02 令牌桶限流算法
- 限流策略，是在高并发流量下保护系统稳定性的一种策略。
- 当然，在实际业务开发中，限流无处不在，比如：
  - 线程池、连接池这些通过限制总的并发数量避免资源过度使用。
  - Nginx 反向代理服务器上通过 limit_conn 模块限制瞬时并发连接数
  - 在方法层面通过 Sentinel、RateLimiter 等工具限制接口的并发请求数量等等
- 他们的核心目标，都是限制并发请求数量，避免系统被压垮导致不可用的问题。在限流的整个体系里面，我认为有三个比较重要的纬度
  - 资源，也就是针对什么资源进行限流，比如接口，或者连接等
  - 阈值，流量峰值达到多少后限制后续流量的访问
  - 触发限流后的行为，比如熔断、降级等
- 限流算法是整个限流实现的核心，不同限流算法，能够对流量的精准控制粒度，以及是否能支持突发流量等情况进行控制
- 常见的限流算法，滑动窗口、令牌桶、漏桶等。
> 令牌桶是一种控制请求访问速率的算法。
它具体工作原理是：系统以一定速率生成令牌并放到令牌桶里面。然后所有的客户端请求进入到系统后，先从令牌桶里面获取令牌，成功获取到令牌表示可以正常访问。如果取不到令牌，说明请求流量大于令牌生成速率，也就是并发数超过系统承载的阈值，就会触发限流的动作。
在流量较低的情况下，令牌桶可以缓存一定数量的令牌，所以令牌桶可以处理瞬时突发流量